参考资料：

STM32F4开发指南-库函数版本_V1.1.pdf\第八章 按键输入实验

8，STM32参考资料\STM32F4xx中文参考手册.pdf\第七章 通用 I/O  

### 一、按键实验硬件连接

按键直接接引脚，具体引脚自己看开发板，注意上下拉。

### 二、GPIO输入操作说明

（1）读取IO口高低电平方式

- 读取IO口输入电平库函数

  uint8_t GPIO_ReadInputDataBit(GPIO_TypeDef* GPIOx, uint16_t GPIO_Pin);

- 读取IO口输入电平操作寄存器

  GPIOx_IDR:端口输入寄存器

- 使用位带带操作读取IO口输入电平方法

  PEin(n)——读取GPIOE.n口电平

### 三、按键实验

1）程序组成

- 使能时钟。调用函数RCC_AHB1PeriphClockCmd():

  ==不同的外设调用的时钟使能函数可能不一样==

- 初始化IO口模式：上拉/下拉输入。调用GPIO_lnit();

- 扫描IO口电平。（库函数/寄存器/位操作）

（2）按键扫描思路

- 支持连续按

  ```c
  u8 KEY_Scan(viod){
      if(KEY按下){
          delay_ms(10);//延时10~20秒，防抖
          if(KEY确实按下){
          return KEY_Value;
      }
      return 无效值；
    }
  }
  ```

  

- 不支持连续按

  ```c
  u8 KEY_Scan(viod){
  	static u8 key_up=1;//staic关键字定义静态局部变量
      if(key_up&&KEY按下){
          delay_ms(10);//延时10~20秒，防抖
          key_up=0;//标记这次key已经按下
          if(KEY确实按下){
          return KEY_Value;
      }
    }else if(KEY没有按下) key_up=1;
  }
  ```

- 两种都可以

  ```c
  u8 KEY_Scan(u8 mode){
  	static u8 key_up=1;
  	if(mode==1) key_up=1;
      if(key_up&&KEY按下){
          delay_ms(10);//延时10~20秒，防抖
          key_up=0;//标记这次key已经按下
          if(KEY确实按下){
          return KEY_Value;
      }
    }else if(KEY没有按下) key_up=1;
  }
  ```

（3）代码讲解测试

看视频

