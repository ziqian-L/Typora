```C
#include "exti_delay.h"
#include "control.h"
#include "led.h"

uint32_t TIM7_delay_ms;

/**
 * 设置定时器延时的时间长短
 * 不能在循环中使用，设置一次后不能再执行，否则会一直延时
**/
void TIM7_exti_delay_ms(uint32_t delay_ms)
{
    TIM7_delay_ms = delay_ms;

    //清零计数值
    TIM7->CNT = 0;

    //使能定时器
    TIM_Cmd(TIM7,ENABLE);
}

/****
 * 定时器中断延时：TIM7
 * 中断延时初始化：1ms
****/
void TIM7_delay_Init(void)
{
	NVIC_InitTypeDef NVIC_InitStructure;
	
    TIM7_delay_ms = 0;
    //开启TIM7时钟
    RCC->APB1ENR |= RCC_APB1ENR_TIM7EN;

    //时基单元初始化
    //默认向上计数、预分频系数、自动重装载值
    TIM7->PSC = 84;
    TIM7->ARR = 1000;

    //中断优先级配置
    NVIC_InitStructure.NVIC_IRQChannel = TIM7_IRQn;
    NVIC_InitStructure.NVIC_IRQChannelPreemptionPriority = 0;
    NVIC_InitStructure.NVIC_IRQChannelSubPriority = 0;
    NVIC_InitStructure.NVIC_IRQChannelCmd = ENABLE;
    NVIC_Init(&NVIC_InitStructure);

    //使能定时器中断
    TIM_ITConfig(TIM7,TIM_IT_Update,ENABLE);
}

void TIM7_IRQHandler(void)
{
    if (TIM_GetITStatus(TIM7,TIM_IT_Update) != RESET)
    {
        if (TIM7_delay_ms != 0)
        {
            TIM7_delay_ms--;
            LED0 = 0;
        }
        else
        {
            //关闭定时器
            TIM_Cmd(TIM7,DISABLE);
            //清零计数值
            TIM7->CNT = 0;
            LED0 = 1;
            Flag.Time_up = 1;
        }
    }
    TIM_ClearFlag(TIM7,TIM_IT_Update);
```

