|       定时器种类       | 位数 |     计数器模式      | 产生DMA请求 | 捕获/比较通道 | 互补输出 |                特殊应用场景                 |
| :--------------------: | :--: | :-----------------: | :---------: | :-----------: | :------: | :-----------------------------------------: |
| 高级定时器(TIM1、TIM8) |  16  | 向上、向下、向上/下 |    可以     |       4       |    有    |           带可编程死区的互补输出            |
| 通用定时器(TIM2、TIM5) |  32  | 向上、向下、向上/下 |    可以     |       4       |    无    | 通用。定时计数、PWM输出、输入捕获、输出比较 |
| 通用定时器(TIM3、TIM4) |  16  | 向上、向下、向上/下 |    可以     |       4       |    无    | 通用。定时计数、PWM输出、输入捕获、输出比较 |
| 通用定时器(TIM9~TIM14) |  16  |        向上         |    没有     |       2       |    无    | 通用。定时计数、PWM输出、输入捕获、输出比较 |
| 基本定时器(TIM6、TIM7) |  16  | 向上、向下、向上/下 |    可以     |       0       |    无    |              主要应用于驱动DAC              |

### 定时器初始化

#### 使能时钟

```C
//TIM 2,3,4,5,6,7,12,13,14的时钟来源于APB1
//TIM2  ---> RCC->APB1ENR |= 1<<0;
//TIM3  ---> RCC->APB1ENR |= 1<<1;
//TIM4  ---> RCC->APB1ENR |= 1<<2;
//TIM5  ---> RCC->APB1ENR |= 1<<3;
//TIM6  ---> RCC->APB1ENR |= 1<<4;
//TIM7  ---> RCC->APB1ENR |= 1<<5;
//TIM12 ---> RCC->APB1ENR |= 1<<6;
//TIM13 ---> RCC->APB1ENR |= 1<<7;
//TIM14 ---> RCC->APB1ENR |= 1<<8;
//TIM 1,8,9,10,11的时钟来源于APB2
//TIM1  ---> RCC->APB2ENR |= 1<<0;
//TIM8  ---> RCC->APB2ENR |= 1<<1;
//TIM9  ---> RCC->APB2ENR |= 1<<16;
//TIM10 ---> RCC->APB2ENR |= 1<<17;
//TIM11 ---> RCC->APB2ENR |= 1<<18;
```

#### 定时器初始化

根据官方的库函数可知，初始化定时器需要用到

- CR1:计数器模式选择、时钟分频
  - 计数器模式选择
    - 使用	位 4 DIR：方向、位 6:5 CMS[1:0]：中心对齐模式选择
    - DIR：==0==：递增计数、==1==：递减计数
    - CMS：==00==：边沿对齐模式、==01==：中心对齐模式1、==10==：中心对齐模式2、==11==：中心对齐模式13
    - 5种模式
      - ==00 0（0）==：向上计数模式
      - ==00 1（1）==：向下计数模式
      - ==01 0（2）==：交替递增计数和递减计数。递减计数时，配置为输出的通道(TIMx_CCMRx寄存器)的输出比较中断标志才置 1。
      - ==10 0（4）==：交替递增计数和递减计数。递增计数时，配置为输出的通道(TIMx_CCMRx寄存器)的输出比较中断标志才置 1。
      - ==11 0（6）==：交替递增计数和递减计数。递减或增计数时，配置为输出的通道(TIMx_CCMRx寄存器)的输出比较中断标志都置 1。
  - 时钟分频
    - 使用	位 9:8 CKD[1:0]：时钟分频
    - 指示定时器时钟源频率与采样时钟 (tDTS) 之间的分频比
      - ==00==：$t_{DTS}=t_{CK\_INT}$					==01==：$t_{DTS}=2*t_{CK\_INT}$					==10==：$t_{DTS}=4*t_{CK\_INT}$
- PSC:预分频系数
  - 将经过时钟分频的值再次分频。
  - 0~65535

- ARR:自动重装载值
  - ARR 为要装载到实际自动重载寄存器的值。
  - 0~65535
- RCR:设置重复计数值(仅TIM1和TIM8有)
  - 设置比较寄存器的更新频率，即重载RCR+1次后才能触发更新事件UEV
  - 0~255


```c
/*******************************************
 * 系统时钟168Mhz不分频,AHB时钟 168Mhz;
 * APB1 4分频 42MHz
 * APB2 2分频 84Mhz
 * APBx的分频系数为1时，通用计时器的时钟为APB1x时钟的值
 * APBx的分频系数不为1时，通用计时器的时钟为APBx时钟的两倍
 * TIM 2,3,4,5,6,7,12,13,14的时钟来源于APB1 * 2 = 84MHz
 * TIM 1,8,9,10,11的时钟来源于APB2 * 2 = 168MHz
*******************************************/

//TIM1、TIM8定时器初始化,5ms溢出一次
//APB2时钟初始化
RCC->APB2ENR |= 1<<0;
//计数器模式
//0:向上计数模式		1:向下计数模式
TIM1->CR1 |= 0<<4;
//时钟分频
//0:tDTS = tCK_INT		1:tDTS = 2*tCK_INT		2:tDTS = 4*tCK_INT
TIM1->CR1 |= 0<<8;
//预分频系数
//0~65535
TIM1->PSC |= 168;
//自动重装载值
//0~65535
TIM1->ARR |= 5000;
//设置重复计数值(仅TIM1和TIM8有)
//0~255
TIM1->RCR |= 0;

//TIM2、TIM3、TIM4、TIM5定时器初始化
//APB1时钟初始化
RCC->APB1ENR |= 1<<0;
//向上计数模式、时钟不分频、自动重装载值、预分频系数
//装载值被设定为0xffff及以下的值时候，TIM2和TIM5是16位计数器。装载值被设定为0xffff-0xffffffff之间的时候，TIM2和TIM5是32位计数器。
TIM2->CR1 |= 0<<4;
TIM2->CR1 |= 0<<8;
TIM2->PSC |= psc;
TIM2->ARR |= arr;

//TIM9~TIM14定时器初始化
//APB2时钟初始化
RCC->APB2ENR |= 1<<16;
//默认向上计数、时钟不分频、自动重装载值、预分频系数
TIM9->CR1 |= 0<<8;
TIM9->PSC |= psc;
TIM9->ARR |= arr;

//TIM6、TIM7定时器初始化
//APB1时钟初始化
RCC->APB1ENR |= 1<<5;
//默认向上计数、自动重装载值、预分频系数
TIM6->PSC |= psc;
TIM6->ARR |= arr;
```



