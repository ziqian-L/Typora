<iframe src="//player.bilibili.com/player.html?aid=717344587&bvid=BV1qQ4y127Pj&cid=388486894&page=1" scrolling="no" border="0" frameborder="no" height="600" framespacing="0" allowfullscreen="true"> </iframe>

# 一、起摆

## 1.简单的方法

角度环+速度环

角度环+位置环

角度环+位置环+速度环

## 2.思路

首先给一个方向的力，在下落时给一个与下落方向相同的力，反复，直到平衡

遇到的问题：

- 起摆范围过大，起摆后一直不稳定
- 起摆到顶点后，速度不为0，导致电机控制不住，起摆失败

解决方案：

- 加位置环的比例向 P

- 限制摆动范围，荡起来停一下，由于惯性，摆杆会向上运动一段，此时再给一个反向的力，起摆就更快
- 荡起来后停一下，可以使摆杆到顶点时速度较小，容易被控制

# 二、圆周运动

##1.角度环+速度环

想法：改变速度环目标位置来实现运动

结果：一边简谐震荡，一边圆周运动



修改：减去速度环的积分项 I ，只留下比例项 P ，控制结果更好

## 2.角度环+位置环

想法：改变速度环目标位置来实现运动

结果：一边简谐震荡，一边圆周运动

## 3.角度环+位置环+速度环

想法：改变速度环目标位置来实现运动

结果：一边轻微简谐震荡，一边圆周运动

# 三、程序思路

初始化：

- OLED：用于显示，可以不使用
- 按键：用于选择模式
- ADC：采集角度
- 电机初始化：用于读取
- PWM输出：用于控制电机
- 定时器：用于控制定时中断
- 中断：用于控制定时数据采集并控制

控制（角度环 + 控制环）：

- 数据采集的同时进行控制：采集角位移传感器的模拟数据通过ADC转换成数字量，PID 控制 "角度环 + 速度环"
- 不停的识别按键，直到按键发生变化，切换到转圈模式

```
主函数{
	初始化
	OLED初始化
	按键初始化
	ADC采集函数初始化
		//ADC1通道5初始化,使用PA5
	定时器中断函数初始化
		//TIM2
	定时器编码器模式函数初始化
		//PA6,PA7   TIM3
	PWM输出函数初始化
		//TIM1_CH1 PA8
	控制函数初始化
	
	死循环{
		OLED显示角度
		OLED显示速度
		OLED显示PWM输出
		
		读取键值并判断是模式几
			key1:mode1(起摆并使用LQR（+5 ~ -5）稳定)
			key2:mode2(摆臂做圆周运动（使用PID控制）)
			key3:mode3(切换到PID双环（速度环+位置环）控制)
			key4:mode4(摆杆做圆周运动)
		}
	}
```

# 四、关于双环PID

##1.关于PID控制 位置式和增量式的选择

###（1）位置式和增量式PID的特点比较

- 位置式PID控制的输出与整个过去的状态有关，用到了误差的累加值；

  而增量式PID的输出只与当前拍和前两拍的误差有关，因此位置式PID控制的累积误差相对更大；

- 增量式PID控制输出的是控制量增量，并无积分作用，因此该方法适用于执行机构带积分部件的对象，如步进电机等；

  而位置式PID适用于执行机构不带积分部件的对象，如帆板控制系统中的风机。

- 由于增量式PID输出的是控制量增量，如果计算机出现故障，误动作影响较小，而执行机构本身有记忆功能，可仍保持原位，不会严重影响系统的工作；

  而位置式的输出直接对应对象的输出，因此对系统影响较大。

### （2）如何选择

直流电机带积分部件

#五、关于LQR控制

使用物理建模的微分方程求解出A阵、B阵，再写出Q阵，R阵。
最后使用MATLAB中的计算函数求解出K值
使用该公式$U=[K_1, K_2, K_3, K_4]\times\begin{bmatrix} x\\ \dot{x}\\ \psi\\ \dot{\psi} \end{bmatrix}$确定输出量u

$x$为电机路程，$\dot{x}$为电机速度，$\psi$为传感器角度，$\dot{\psi}$为传感器角速度

